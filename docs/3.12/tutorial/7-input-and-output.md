# 7. Ввод и вывод

[Оригинал](https://docs.python.org/3.12/tutorial/inputoutput.html)

Программа выводит данные несколькими способами: печатаются читаемые человеком строки либо записываются файлы для последующего использования. Этот раздел описывает возможности вывода.

## 7.1. Форматированный вывод

До сих пор мы использовали два способа отображения значений: выражения и функцию `print()`. Есть несколько способов управления форматом вывода.

- Для использования строковых литералов формата (`f`-строки) нужно поставить перед открывающей кавычкой символ `f` или `F`, внутри строки между фигурными скобками `{ }` указать выражение, которое ссылается на переменные или константы.

```python
year = 2016
event = 'Referendum'
f'Результаты {year}-го года {event}'
# Результаты 2016-го года Referendum
```

- Метод `.format()` позволяет вручную управлять форматированием. Внутри строки указываются поля замены через фигурные скобки `{ }`.

```python
yes_votes = 42_572_654
total_votes = 85_705_149
percentage = yes_votes / total_votes
'{:-9} YES голосов {:2.2%}'.format(yes_votes, percentage)
# ' 42572654 YES голосов 49.67%'
```

- Можно самостоятельно обрабатывать строки, используя операции нарезки и конкатенации для получения нужного макета. Строки имеют методы выравнивания до заданной ширины колонок.

Функция `repr()` возвращает представление объекта, пригодное для чтения интерпретатором, тогда как функция `str()` предназначена для удобочитаемого представления объектов.

### 7.1.1. Литералы формата строк

Литералы формата позволяют вставлять значение выражений внутрь строки, предваряя её символом `f` или `F`. Например, округление числа π до трёх знаков после запятой выглядит следующим образом:

```python
import math
print(f'Значение π примерно равно {math.pi:.3f}.')
# Значение π примерно равно 3.142.
```

Можно задать минимальную ширину поля, добавив число после двоеточия:

```python
table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 7678}
for name, phone in table.items():
    print(f'{name:10} => {phone:10d}')
# Sjoerd     =>       4127
# Jack       =>       4098
# Dcab       =>       7678
```

Модификаторы преобразуют значение перед форматированием:

```python
animals = 'eels'
print(f'My hovercraft is full of {animals}.') # My hovercraft is full of eels.
print(f'My hovercraft is full of {animals!r}.') # My hovercraft is full of 'eels'.
```

Спецификатор `=` расширяет выражение до имени переменной, знака равенства и результата вычисления:

```python
bugs = 'roaches'
count = 13
area = 'living room'
print(f'Debugging {bugs=}, {count=}, {area=}')
# Debugging bugs='roaches', count=13, area='living room'
```

См. также мини-справочник по спецификациям формата.

### 7.1.2. Метод str.format()

Метод `.format()` заменяет указанные в строке поля значениями аргументов функции. Простейший пример:

```python
print('Мы — {} кто говорят "{}"!'.format('рыцари', 'Ни'))
# Мы — рыцари кто говорят "Ни"!
```

Позиция аргумента задаётся числом в поле:

```python
print('{0} и {1}'.format('спам', 'яйца')) # спам и яйца
print('{1} и {0}'.format('спам', 'яйца')) # яйца и спам
```

При именованных аргументах используется имя параметра:

```python
print('Это {food} абсолютно ужасно.'.format(
      food='спам', adjective='абсолютно ужасно'))
# Это спам абсолютно ужасно.
```

Именованные аргументы можно комбинировать с позиционными:

```python
print('История про {}, {}, и {}.'.format('Билл', 'Манфред',
                                        other='Георг'))
# История про Билл, Манфред, и Георг.
```

Для длинных строк удобно передавать словарь и обращаться к ключам через квадратные скобки:

```python
table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 8637678}
print('Jack: {0[Jack]:d}; Sjoerd: {0[Sjoerd]:d}; '
      'Dcab: {0[Dcab]:d}'.format(table))
# Jack: 4098; Sjoerd: 4127; Dcab: 8637678
```

Или передать словарь как именованные параметры с помощью оператора `**`:

```python
table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 8637678}
print('Jack: {Jack:d}; Sjoerd: {Sjoerd:d}; Dcab: {Dcab:d}'.format(**table))
# Jack: 4098; Sjoerd: 4127; Dcab: 8637678
```

Пример аккуратного выравнивания столбцов чисел и степеней:

```python
for x in range(1, 11):
    print('{0:2d} {1:3d} {2:4d}'.format(x, x*x, x*x*x))
#  1   1    1
#  2   4    8
# ...
# 10 100 1000
```

Подробности см. в разделе синтаксиса форматирования строк.

### 7.1.3. Ручная обработка строк

Таблица квадратов и кубов, оформленная вручную:

```python
for x in range(1, 11):
    print(repr(x).rjust(2), repr(x*x).rjust(3), end=' ')
    print(repr(x*x*x).rjust(4))
#  1   1    1
#  2   4    8
# ...
# 10 100 1000
```

Методы строкового типа:

- `.rjust(width)` — выравнивание вправо
- `.ljust(width)` — выравнивание влево
- `.center(width)` — центрирование
- `.zfill(width)` — заполнение нулями слева

### 7.1.4. Старый способ форматирования строк

Оператор `%` поддерживает форматирование строк аналогично printf:

```python
import math
print('Значение π приблизительно %.3f.' % math.pi)
# Значение π приблизительно 3.142.
```

Дополнительную информацию см. в разделе старого стиля форматирования строк.

## 7.2. Чтение и запись файлов

Функция `open()` открывает файловый объект двумя обязательными аргументами и одним необязательным:

```python
f = open('workfile', 'w', encoding='utf-8')
```

Режимы открытия файла:

- `'r'` — чтение
- `'w'` — перезапись существующего файла
- `'a'` — дозапись в конец файла
- `'r+'` — чтение и запись одновременно
- Добавка буквы `'b'` открывает файл в бинарном режиме

Рекомендуется указывать явный параметр `encoding="utf-8"` для работы с текстом.

Используйте конструкцию `with`, чтобы автоматически закрывать файл после завершения операций:

```python
with open('workfile', encoding='utf-8') as f:
    read_data = f.read()
```

После закрытия файла попытки обращения к нему приведут к ошибке.

### 7.2.1. Методы файловых объектов

Основные методы:

- `f.read(size)` — считывание содержимого файла целиком или частично
- `f.readline()` — считывание одной строки
- `f.write(string)` — запись строки в файл
- `f.tell()` — получение текущей позиции в файле
- `f.seek(offset, whence)` — изменение позиции в файле относительно начала, текущего положения или конца файла

Примеры:

```python
f.read() # 'Это весь файл.'
f.read() # ''
```

Чтение построчно:

```python
for line in f:
    print(line, end='')
```

Запись данных:

```python
f.write('Тестовая строка\n') # 15
```

Другие объекты требуют предварительного преобразования в строку или байтовый объект.

### 7.2.2. Сохранение структурированных данных с использованием модуля json

Python поддерживает популярный формат обмена данными JSON. Модуль `json` сериализует структуры данных в строки и обратно.

Простая демонстрация сериализации списка:

```python
import json
x = [1, 'простое', 'список']
json.dumps(x) # '[1, "простое", "список"]'
```

Сериализация в файл:

```python
json.dump(x, f)
```

Десериализация из файла:

```python
x = json.load(f)
```

Примечание: JSON-файлы должны быть закодированы в UTF-8.

Альтернативой является модуль `pickle`, позволяющий сохранять произвольные объекты Python, однако он специфичен для Python и небезопасен по умолчанию.
