# 6. Модули

[Оригинал](https://docs.python.org/3.12/tutorial/modules.html)

Модуль — файл с определениями функций и инструкциями на Python. Имя модуля совпадает с именем файла с расширением `.py`. Переменная `__name__` хранит имя модуля в виде строки.

Пример модуля `fibo.py`, содержащего функции Фибоначчи:

```python
# fibo.py
# модуль чисел Фибоначчи

def fib(n):
    # выводит числа Фибоначчи до n
    a, b = 0, 1
    while a < n:
        print(a, end=' ')
        a, b = b, a+b
    print()

def fib2(n):
    # возвращает список чисел Фибоначчи до n
    result = []
    a, b = 0, 1
    while a < n:
        result.append(a)
        a, b = b, a+b
    return result
```

Импорт модуля выполняется командой:

```python
import fibo
```

Функции вызываются через точку после имени модуля:

```python
fibo.fib(1000)
# 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987

fibo.fib2(100)
# [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]

fibo.__name__
# 'fibo'
```

Часто используемые функции можно присвоить локальным именам:

```python
fib = fibo.fib
fib(500)
# 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377
```

## 6.1. Дополнительная информация о модулях

### 6.1.1. Выполнение модулей как скриптов

При запуске модуля как скрипта (`python fibo.py`) глобальная переменная `__name__` принимает значение `"__main__"`.

Добавив проверку условия в конце модуля, можно сделать его одновременно скриптом и модулем:

```python
if __name__ == "__main__":
    import sys
    fib(int(sys.argv[1]))
```

Запустим модуль как скрипт:

```bash
python fibo.py 50
# 0 1 1 2 3 5 8 13 21 34
```

### 6.1.2. Поиск путей модулей

Поиск модулей осуществляется в следующих местах:

- Каталог текущего сценария
- Перечень каталогов из переменной окружения PYTHONPATH
- Стандартный путь установки библиотек Python

Переменную поиска можно изменить динамически:

```python
import sys
sys.path.append('/ufs/guido/lib/python')
```

### 6.1.3. Скомпилированные файлы Python (.pyc)

Для ускорения загрузки модули компилируются в байт-код и сохраняются в файлах формата `<модуль>.<версия>.pyc` внутри каталога `__pycache__`.

Файлы `.pyc` загружаются быстрее, но скорость выполнения программы остается прежней.

Можно принудительно создать такие файлы с помощью команды:

```bash
python -m compileall .
```

## 6.2. Стандартные модули

Стандартная библиотека Python содержит набор встроенных модулей, доступ к которым описан отдельно ("Библиотека Python").

Некоторые важные стандартные модули:

- `sys`: обеспечивает доступ к параметрам системы и функциям интерпретатора.
- `os`: работа с операционной системой.
- `datetime`: операции с датой и временем.

Примеры работы с модулем `sys`:

```python
import sys
sys.ps1
# '>>> '

sys.ps2
# '... '

sys.path.append('/new/path')
```

## 6.3. Функция dir()

Функция `dir()` показывает доступные имена в модуле или пространстве имен:

```python
import fibo, sys
dir(fibo)
# ['__name__', 'fib', 'fib2']

dir(sys)
# большой список всех атрибутов и методов модуля sys
```

Без аргументов отображает текущее пространство имен:

```python
a = [1, 2, 3, 4, 5]
import fibo
fib = fibo.fib
dir()
# ['__builtins__', '__name__', 'a', 'fib', 'fibo', 'sys']
```

Чтобы увидеть встроенные объекты, используйте модуль `builtins`:

```python
import builtins
dir(builtins)
# полный список встроенных объектов
```

## 6.4. Пакеты

Пакеты позволяют структурировать пространства имен модулей с использованием точечной записи («дот-нотации»). Например, пакет `A.B` обозначает подпакет `B` пакета `A`.

Пример структуры пакета:

```
sound/
    __init__.py
    formats/
        __init__.py
        wavread.py
        wavwrite.py
        ...
    effects/
        __init__.py
        echo.py
        surround.py
        ...
    filters/
        __init__.py
        equalizer.py
        ...
```

Подмодули импортируются следующим образом:

```python
import sound.effects.echo
sound.effects.echo.echofilter(input, output, delay=0.7, atten=4)
```

Альтернативные способы импорта:

```python
from sound.effects import echo
echo.echofilter(input, output, delay=0.7, atten=4)

from sound.effects.echo import echofilter
echofilter(input, output, delay=0.7, atten=4)
```

### 6.4.1. Импорт всего содержимого (\*)

Использование конструкции `from package import *` требует явного определения списка экспортируемых элементов в пакете через переменную `__all__` в файле `__init__.py`:

```python
__all__ = ["echo", "surround"]
```

### 6.4.2. Внутрипакетные ссылки

Относительные импортирования используют точки перед названием модуля:

```python
from . import echo
from .. import formats
from ..filters import equalizer
```

### 6.4.3. Расположение пакетов в нескольких директориях

Атрибут `__path__` позволяет расширить пути поиска модулей, позволяя искать пакеты в разных каталогах.
